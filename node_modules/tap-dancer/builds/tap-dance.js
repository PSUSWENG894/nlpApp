'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var Transform=require('stream').Transform,parser=require('tap-out'),chalk=require('chalk'),path=require('path'),_=require('lodash'),PAD='  ',icons={failure:chalk.red('linux'===process.platform?'\u2718':'x'),success:chalk.green('linux'===process.platform?'\u2022':'.')},pretty=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',')};function padRight(a,b){return'undefined'==typeof b?a:(b+a).substring(0,a.length)}var TapDance=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.parser=parser(),a.extra=[],a.assertCount=0,a.timestamp=Date.now(),a.failed=!1,a.outLine(),a.parser.on('assert',function(b){b.ok?a.push(icons.success):(a.push(icons.failure),a.failed=!0),a.assertCount++}),a.parser.on('extra',function(b){''!==b&&a.extra.push(b)}),a.on('finish',function(){return a.parser.end()}),a}return _inherits(b,a),_createClass(b,[{key:'_transform',value:function _transform(a,b,c){this.parser.write(a,b,c)}},{key:'_flush',value:function _flush(a){var b=this;this.parser.on('output',function(c){c.fail&&c.fail.length||0===b.assertCount?(b.outSpacer(2),b.outputExtra(),b.statsOutput(c),b.outSpacer(2),b.outLine(),_(c.fail).map(function(b){return _.defaults({test:_.find(c.tests,['number',b.test])},b)}).groupBy(function(b){return b.test.number}).forEach(function(a){var c=a[0].test.name,d=a[0].error.at.file.replace(/^.+test\//,'');d=path.relative(process.cwd(),d),d='./'+d;var e=a[0].error.at.line;(e||0===e)&&(d+=':'+e),b.outLine(chalk.red('x')+' '+chalk.white(chalk.underline(c))+'   '+chalk.grey(d)),b.outLine(),_.forEach(a,function(a){var c=a.name||'';c=padRight('                        ',c),b.push(chalk.white('    '+chalk.red('-')+' '+c));var d=a.error.actual;'string'==typeof d&&100<d.length&&(d=d.substr(0,100)+'..'),b.push(chalk.gray('    - got: '+chalk.magenta('"'+d+'"'))),b.outLine()}),b.outLine()}),b.outLine()):(b.outSpacer(2),b.statsOutput(c),b.outLine(),b.outLine()),a()})}},{key:'outputExtra',value:function outputExtra(){this.push(this.extra.join('\n'))}},{key:'outPush',value:function outPush(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'',b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'white';this.push('  '+chalk[b](a))}},{key:'outLine',value:function outLine(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'',b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'white';this.outPush(a+'\n',b)}},{key:'outSpacer',value:function outSpacer(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this.push('\n'.repeat(a))}},{key:'statsOutput',value:function statsOutput(a){var b=((Date.now()-this.timestamp)/1e3).toFixed(2),c=pretty(a.asserts.length),d=pretty(a.pass.length),e=a.fail.length,f='  '+chalk.green(d)+' of '+c;if(this.push(f),this.outLine(),0===e){var g='  ';g+=chalk.gray(' \u2714\uFE0F     '+b+'s'),this.push(g)}else{var h='failure';1<e&&(h='failures'),this.outLine(pretty(e)+' '+h+' \u25E0\u25E1\u25DC\u25E0\u25E1-\u25E1\u25DC','red')}}}]),b}(Transform);module.exports=TapDance;
